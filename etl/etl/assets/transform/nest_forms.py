import pprint
import copy
from dagster import (
    asset,
    AssetExecutionContext,
    get_dagster_logger,
    MetadataValue
)
import pandas as pd

# Constants
TENSE_TAGS = {'present', 'past', 'future', 'conditional', 'imperative'}
PERSON_TAGS = {'first-person', 'second-person', 'third-person', 'impersonal'}
CASES_TAGS = {'nominative', 'genitive', 'dative', 'accusative', 'instrumental', 'locative', 'vocative'}
NUMBER_TAGS = {'singular', 'plural'}
GENDER_TAGS = {'masculine', 'neuter', 'feminine', 'virile', 'nonvirile'}
VIRILITY_TAGS = {'virile', 'nonvirile'}
ANIMACY_TAGS = {'animate', 'inanimate'}
ADDITIONAL_CATEGORIES = {'comparative', 'superlative', 'adverb', 'adjective', 'abbreviation', 'diminutive', 'augmentative'}
RECOGNIZED_TAGS = TENSE_TAGS | PERSON_TAGS | CASES_TAGS | NUMBER_TAGS | GENDER_TAGS | VIRILITY_TAGS | ANIMACY_TAGS | ADDITIONAL_CATEGORIES | {'derogatory'}


def extract_source(data):
    """returns the first one as a string (e.g. 'declension').

    Note: Sometimes multiple sources exist, but they are all the same types
    (i.e. ['declension', 'declension', 'declension'] is possible,
    but ['inflection', 'declension'] is not possible). 
    Thus this function returns the string instead of the list"""
    
    for item in data:
        if isinstance(item, dict):
            if item.get('tags') == ["inflection-template"]:
                if 'conj' in item['form']:
                    return 'conjugation'
                else:
                    return 'declension'
    for item in data:
        if isinstance(item, dict):
            # Now it's safe to use 'get'
            if item.get('source'):
                return item['source']
            
    return None  # Return None if no match found


# Helper Functions

def is_form_valid(tags):
    return all(tag in RECOGNIZED_TAGS for tag in tags)

def process_tags(form, tags, result, source):
    derogatory = 'derogatory' in tags
    number_tags = NUMBER_TAGS.intersection(tags)
    gender_tags = GENDER_TAGS.intersection(tags)

    if source == 'declension' or source == 'inflection':
        case_tags = CASES_TAGS.intersection(tags)

        if case_tags:
            process_case_tags(form, tags, result, derogatory)
        elif number_tags:
            process_number_tags(form, tags, result, None, derogatory)
        elif gender_tags:
            process_gender_tags(form, tags, result, None, derogatory)
    elif source == 'conjugation':
        tense_tags = TENSE_TAGS.intersection(tags)
        person_tags = PERSON_TAGS.intersection(tags)

        if tense_tags:
            process_tense_tags(form, tags, result, derogatory)
        elif person_tags:
            process_person_tags(form, tags, result, None, derogatory)
        elif number_tags:
            process_number_tags(form, tags, result, None, derogatory)
        elif gender_tags:
            process_gender_tags(form, tags, result, None, derogatory)

def process_tense_tags(form, tags, result_dict, derogatory):
    for tense in TENSE_TAGS.intersection(tags):
        if PERSON_TAGS.intersection(tags):
            result_tense = result_dict.setdefault(tense, {})
            process_person_tags(form, tags, result_tense, tense, derogatory)
        elif NUMBER_TAGS.intersection(tags):
            result_tense = result_dict.setdefault(tense, {})
            process_number_tags(form, tags, result_tense, tense, derogatory)
        elif GENDER_TAGS.intersection(tags):
            result_tense = result_dict.setdefault(tense, {})
            process_gender_tags(form, tags, result_tense, tense, derogatory)
        else:
            update_result(form, result_dict, tense, derogatory)

def process_person_tags(form, tags, result_dict, key_above, derogatory):
    for person in PERSON_TAGS.intersection(tags):
        if NUMBER_TAGS.intersection(tags):
            result_person = result_dict.setdefault(person, {})
            process_number_tags(form, tags, result_person, person, derogatory)
        elif GENDER_TAGS.intersection(tags):
            result_person = result_dict.setdefault(person, {})
            process_gender_tags(form, tags, result_person, person, derogatory)
        else:
            update_result(form, result_dict, person, derogatory)

def process_case_tags(form, tags, result_dict, derogatory):
    for case in CASES_TAGS.intersection(tags):
        if NUMBER_TAGS.intersection(tags):
            result_case = result_dict.setdefault(case, {})
            process_number_tags(form, tags, result_case, case, derogatory)
        elif GENDER_TAGS.intersection(tags):
            result_case = result_dict.setdefault(case, {})
            process_gender_tags(form, tags, result_case, case, derogatory)
        else:
            update_result(form, result_dict, case, derogatory)

def process_number_tags(form, tags, result_dict, key_above, derogatory):
    for number in NUMBER_TAGS.intersection(tags):
        if GENDER_TAGS.intersection(tags):
            result_number = result_dict.setdefault(number, {})
            process_gender_tags(form, tags, result_number, number, derogatory)
        else:
            update_result(form, result_dict, number, derogatory)

def process_gender_tags(form, tags, result_dict, key_above, derogatory):
    for gender in (GENDER_TAGS.intersection(tags)):
        if ANIMACY_TAGS.intersection(tags):
            result_gender = result_dict.setdefault(gender, {})
            process_animacy_tags(form, tags, result_gender, gender, derogatory)
        else:
            update_result(form, result_dict, gender, derogatory)

def process_animacy_tags(form, tags, result_dict, key_above, derogatory):
    for animacy in (ANIMACY_TAGS.intersection(tags)):
        update_result(form, result_dict, animacy, derogatory)

def update_result(form, result_dict, key, derogatory, set_default=False):
    if isinstance(result_dict, dict):
        if key is not None:
            if set_default:
                # Set the form only if the key is not already in the dictionary
                result_dict.setdefault(key, form)
            else:
                # Update the form for the key
                if derogatory:
                    result_dict[key] = result_dict.get(key, '') + ' / ' + form
                else:
                    result_dict[key] = form

        else:
            # If there's no key, we should decide what to do. This requires more context on the data structure.
            # Maybe raise an error or log a warning because the expected structure is not met?
            raise ValueError("Key is None, cannot update result_dict without a valid key.")
    else:
        # pprint.pprint(form)
        # print(result_dict)
        pass

def process_forms(forms):
    result = {}
    invalid_forms = []

    source = extract_source(forms)

    if source is None:
        return pd.Series([result, invalid_forms, 100])


    for form_dict in forms:
        # Check if both 'form' and 'tags' keys exist
        if 'form' not in form_dict or 'tags' not in form_dict or 'source' not in form_dict:
            invalid_forms.append(form_dict)
            continue  # Skip this iteration if 'form' or 'tags' do not exist

        tags = form_dict['tags']
        if all(tag in RECOGNIZED_TAGS for tag in tags):
            process_tags(form_dict['form'], tags, result, source)
        else:
            invalid_forms.append(form_dict)

    valid_forms_count = len(forms) - len(invalid_forms)
    total_forms = valid_forms_count + len(invalid_forms)
    invalid_forms_percent = (100 * len(invalid_forms) / total_forms) if total_forms else 0.0

    return pd.Series([result, invalid_forms, invalid_forms_percent])

@asset
def nest_forms_apply(
    context: AssetExecutionContext,
    add_all_missing_tags_apply: pd.DataFrame
):
    df = add_all_missing_tags_apply 
    df[['nest_forms', 'invalid_forms_in_nest_forms', 'invalid_forms_percent']]= df['forms_with_added_tags'].apply(process_forms)

    context.add_output_metadata(
        metadata={
            "num_records": len(df),  # Metadata can be any key-value pair
            "whole_df_preview": MetadataValue.md(df.head(3).to_markdown()),
            "forms_with_added_tags_preview": MetadataValue.md(df.nest_forms.head(3).to_markdown()),
        }
    )
    nest_forms_apply = df
    return nest_forms_apply

    # inflection_template = extract_inflection_template(forms)

    # if inflection_template is None:
    #     pd.Series([None, None, None])
    # elif 'conj' in inflection_template:
    #     pass
    # else: # 'decl' in inflection_template
    #     pass

# def clean_up_result(result):
#     # Implement the clean up logic as per the original function's last part
#     for case in list(result.keys()):
#         if case not in ADDITIONAL_CATEGORIES and isinstance(result[case], dict):
#             for number, forms in result[case].items():
#                 if isinstance(forms, dict):
#                     # If there is only one gender and it has one animacy status, flatten it
#                     if len(forms) == 1 and isinstance(next(iter(forms.values())), dict) and len(next(iter(forms.values()))) == 1:
#                         gender, animacy_dict = next(iter(forms.items()))
#                         result[case][number] = {gender: next(iter(animacy_dict.values()))}
#                     elif len(forms) == 1 and not isinstance(next(iter(forms.values())), dict):
#                         # If there is only one key and it's not a nested dictionary, flatten it
#                         result[case][number] = next(iter(forms.values()))







# ### run:

# det_data = [{'form': 'kilkunastu', 'tags': ['nominative', 'plural', 'virile'], 'source': 'declension'}, {'form': 'kilkana≈õcie', 'tags': ['nominative', 'plural', 'nonvirile'], 'source': 'declension'}, {'form': 'kilkunastu', 'tags': ['genitive', 'plural', 'nonvirile'], 'source': 'declension'}, {'form': 'kilkunastu', 'tags': ['dative', 'plural', 'nonvirile'], 'source': 'declension'}, {'form': 'kilkunastu', 'tags': ['accusative', 'plural', 'virile'], 'source': 'declension'}, {'form': 'kilkana≈õcie', 'tags': ['accusative', 'plural', 'nonvirile'], 'source': 'declension'}, {'form': 'kilkunastoma', 'tags': ['instrumental', 'plural', 'nonvirile'], 'source': 'declension'}, {'form': 'kilkunastu', 'tags': ['locative', 'plural', 'nonvirile'], 'source': 'declension'}, {'form': 'kilkunastu', 'tags': ['plural', 'virile', 'vocative'], 'source': 'declension'}, {'form': 'kilkana≈õcie', 'tags': ['plural', 'vocative', 'nonvirile'], 'source': 'declension'}]

# verb_data = [{'form': 'moczƒô', 'tags': ['present', 'singular', 'first-person'], 'source': 'conjugation'}, {'form': 'moczymy', 'tags': ['plural', 'present', 'first-person'], 'source': 'conjugation'}, {'form': 'moczysz', 'tags': ['present', 'singular', 'second-person'], 'source': 'conjugation'}, {'form': 'moczycie', 'tags': ['plural', 'present', 'second-person'], 'source': 'conjugation'}, {'form': 'moczy', 'tags': ['present', 'singular', 'third-person'], 'source': 'conjugation'}, {'form': 'moczƒÖ', 'tags': ['plural', 'present', 'third-person'], 'source': 'conjugation'}, {'form': 'moczy siƒô', 'tags': ['impersonal', 'present'], 'source': 'conjugation'}, {'form': 'moczy≈Çem', 'tags': ['masculine', 'past', 'singular', 'first-person'], 'source': 'conjugation'}, {'form': '-(e)m moczy≈Ç', 'tags': ['masculine', 'past', 'singular', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çam', 'tags': ['feminine', 'past', 'singular', 'first-person'], 'source': 'conjugation'}, {'form': '-(e)m moczy≈Ça', 'tags': ['feminine', 'past', 'singular', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çom', 'tags': ['neuter', 'past', 'singular', 'first-person'], 'source': 'conjugation'}, {'form': '-(e)m moczy≈Ço', 'tags': ['neuter', 'past', 'singular', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'moczyli≈õmy', 'tags': ['past', 'plural', 'virile', 'first-person'], 'source': 'conjugation'}, {'form': '-(e)≈õmy moczyli', 'tags': ['past', 'plural', 'virile', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çy≈õmy', 'tags': ['nonvirile', 'past', 'plural', 'first-person'], 'source': 'conjugation'}, {'form': '-(e)≈õmy moczy≈Çy', 'tags': ['nonvirile', 'past', 'plural', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çe≈õ', 'tags': ['masculine', 'past', 'singular', 'second-person'], 'source': 'conjugation'}, {'form': '-(e)≈õ moczy≈Ç', 'tags': ['masculine', 'past', 'singular', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'moczy≈Ça≈õ', 'tags': ['feminine', 'past', 'singular', 'second-person'], 'source': 'conjugation'}, {'form': '-(e)≈õ moczy≈Ça', 'tags': ['feminine', 'past', 'singular', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'moczy≈Ço≈õ', 'tags': ['neuter', 'past', 'singular', 'second-person'], 'source': 'conjugation'}, {'form': '-(e)≈õ moczy≈Ço', 'tags': ['neuter', 'past', 'singular', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'moczyli≈õcie', 'tags': ['past', 'plural', 'virile', 'second-person'], 'source': 'conjugation'}, {'form': '-(e)≈õcie moczyli', 'tags': ['past', 'plural', 'virile', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çy≈õcie', 'tags': ['nonvirile', 'past', 'plural', 'second-person'], 'source': 'conjugation'}, {'form': '-(e)≈õcie moczy≈Çy', 'tags': ['nonvirile', 'past', 'plural', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'moczy≈Ç', 'tags': ['masculine', 'past', 'singular', 'third-person'], 'source': 'conjugation'}, {'form': 'moczy≈Ça', 'tags': ['feminine', 'past', 'singular', 'third-person'], 'source': 'conjugation'}, {'form': 'moczy≈Ço', 'tags': ['neuter', 'past', 'singular', 'third-person'], 'source': 'conjugation'}, {'form': 'moczyli', 'tags': ['past', 'plural', 'third-person', 'virile'], 'source': 'conjugation'}, {'form': 'moczy≈Çy', 'tags': ['nonvirile', 'past', 'plural', 'third-person'], 'source': 'conjugation'}, {'form': 'moczono', 'tags': ['impersonal', 'past'], 'source': 'conjugation'}, {'form': 'bƒôdƒô moczy≈Ç', 'tags': ['future', 'masculine', 'singular', 'first-person'], 'source': 'conjugation'}, {'form': 'bƒôdƒô moczyƒá', 'tags': ['future', 'masculine', 'singular', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'bƒôdƒô moczy≈Ça', 'tags': ['feminine', 'future', 'singular', 'first-person'], 'source': 'conjugation'}, {'form': 'bƒôdƒô moczyƒá', 'tags': ['feminine', 'future', 'singular', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'bƒôdƒô moczy≈Ço', 'tags': ['future', 'neuter', 'singular', 'first-person'], 'source': 'conjugation'}, {'form': 'bƒôdƒô moczyƒá', 'tags': ['future', 'neuter', 'singular', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'bƒôdziemy moczyli', 'tags': ['future', 'plural', 'virile', 'first-person'], 'source': 'conjugation'}, {'form': 'bƒôdziemy moczyƒá', 'tags': ['future', 'plural', 'virile', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'bƒôdziemy moczy≈Çy', 'tags': ['future', 'nonvirile', 'plural', 'first-person'], 'source': 'conjugation'}, {'form': 'bƒôdziemy moczyƒá', 'tags': ['future', 'nonvirile', 'plural', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'bƒôdziesz moczy≈Ç', 'tags': ['future', 'masculine', 'singular', 'second-person'], 'source': 'conjugation'}, {'form': 'bƒôdziesz moczyƒá', 'tags': ['future', 'masculine', 'singular', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'bƒôdziesz moczy≈Ça', 'tags': ['feminine', 'future', 'singular', 'second-person'], 'source': 'conjugation'}, {'form': 'bƒôdziesz moczyƒá', 'tags': ['feminine', 'future', 'singular', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'bƒôdziesz moczy≈Ço', 'tags': ['future', 'neuter', 'singular', 'second-person'], 'source': 'conjugation'}, {'form': 'bƒôdziesz moczyƒá', 'tags': ['future', 'neuter', 'singular', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'bƒôdziecie moczyli', 'tags': ['future', 'plural', 'virile', 'second-person'], 'source': 'conjugation'}, {'form': 'bƒôdziecie moczyƒá', 'tags': ['future', 'plural', 'virile', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'bƒôdziecie moczy≈Çy', 'tags': ['future', 'nonvirile', 'plural', 'second-person'], 'source': 'conjugation'}, {'form': 'bƒôdziecie moczyƒá', 'tags': ['future', 'nonvirile', 'plural', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'bƒôdzie moczy≈Ç', 'tags': ['future', 'masculine', 'singular', 'third-person'], 'source': 'conjugation'}, {'form': 'bƒôdzie moczyƒá', 'tags': ['future', 'masculine', 'singular', 'third-person', 'derogatory'], 'source': 'conjugation'}, {'form': 'bƒôdzie moczy≈Ça', 'tags': ['feminine', 'future', 'singular', 'third-person'], 'source': 'conjugation'}, {'form': 'bƒôdzie moczyƒá', 'tags': ['feminine', 'future', 'singular', 'third-person', 'derogatory'], 'source': 'conjugation'}, {'form': 'bƒôdzie moczy≈Ço', 'tags': ['future', 'neuter', 'singular', 'third-person'], 'source': 'conjugation'}, {'form': 'bƒôdzie moczyƒá', 'tags': ['future', 'neuter', 'singular', 'third-person', 'derogatory'], 'source': 'conjugation'}, {'form': 'bƒôdƒÖ moczyli', 'tags': ['future', 'plural', 'third-person', 'virile'], 'source': 'conjugation'}, {'form': 'bƒôdƒÖ moczyƒá', 'tags': ['future', 'plural', 'third-person', 'virile', 'derogatory'], 'source': 'conjugation'}, {'form': 'bƒôdƒÖ moczy≈Çy', 'tags': ['future', 'nonvirile', 'plural', 'third-person'], 'source': 'conjugation'}, {'form': 'bƒôdƒÖ moczyƒá', 'tags': ['future', 'nonvirile', 'plural', 'third-person', 'derogatory'], 'source': 'conjugation'}, {'form': 'bƒôdzie moczyƒá siƒô', 'tags': ['future', 'impersonal'], 'source': 'conjugation'}, {'form': 'moczy≈Çbym', 'tags': ['conditional', 'masculine', 'singular', 'first-person'], 'source': 'conjugation'}, {'form': 'bym moczy≈Ç', 'tags': ['conditional', 'masculine', 'singular', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çabym', 'tags': ['conditional', 'feminine', 'singular', 'first-person'], 'source': 'conjugation'}, {'form': 'bym moczy≈Ça', 'tags': ['conditional', 'feminine', 'singular', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çobym', 'tags': ['conditional', 'neuter', 'singular', 'first-person'], 'source': 'conjugation'}, {'form': 'bym moczy≈Ço', 'tags': ['conditional', 'neuter', 'singular', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'moczyliby≈õmy', 'tags': ['conditional', 'plural', 'virile', 'first-person'], 'source': 'conjugation'}, {'form': 'by≈õmy moczyli', 'tags': ['conditional', 'plural', 'virile', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çyby≈õmy', 'tags': ['conditional', 'nonvirile', 'plural', 'first-person'], 'source': 'conjugation'}, {'form': 'by≈õmy moczy≈Çy', 'tags': ['conditional', 'nonvirile', 'plural', 'derogatory', 'first-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çby≈õ', 'tags': ['conditional', 'masculine', 'singular', 'second-person'], 'source': 'conjugation'}, {'form': 'by≈õ moczy≈Ç', 'tags': ['conditional', 'masculine', 'singular', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çaby≈õ', 'tags': ['conditional', 'feminine', 'singular', 'second-person'], 'source': 'conjugation'}, {'form': 'by≈õ moczy≈Ça', 'tags': ['conditional', 'feminine', 'singular', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çoby≈õ', 'tags': ['conditional', 'neuter', 'singular', 'second-person'], 'source': 'conjugation'}, {'form': 'by≈õ moczy≈Ço', 'tags': ['conditional', 'neuter', 'singular', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'moczyliby≈õcie', 'tags': ['conditional', 'plural', 'virile', 'second-person'], 'source': 'conjugation'}, {'form': 'by≈õcie moczyli', 'tags': ['conditional', 'plural', 'virile', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çyby≈õcie', 'tags': ['conditional', 'nonvirile', 'plural', 'second-person'], 'source': 'conjugation'}, {'form': 'by≈õcie moczy≈Çy', 'tags': ['conditional', 'nonvirile', 'plural', 'derogatory', 'second-person'], 'source': 'conjugation'}, {'form': 'moczy≈Çby', 'tags': ['conditional', 'masculine', 'singular', 'third-person'], 'source': 'conjugation'}, {'form': 'by moczy≈Ç', 'tags': ['conditional', 'masculine', 'singular', 'third-person', 'derogatory'], 'source': 'conjugation'}, {'form': 'moczy≈Çaby', 'tags': ['conditional', 'feminine', 'singular', 'third-person'], 'source': 'conjugation'}, {'form': 'by moczy≈Ça', 'tags': ['conditional', 'feminine', 'singular', 'third-person', 'derogatory'], 'source': 'conjugation'}, {'form': 'moczy≈Çoby', 'tags': ['conditional', 'neuter', 'singular', 'third-person'], 'source': 'conjugation'}, {'form': 'by moczy≈Ço', 'tags': ['conditional', 'neuter', 'singular', 'third-person', 'derogatory'], 'source': 'conjugation'}, {'form': 'moczyliby', 'tags': ['conditional', 'plural', 'third-person', 'virile'], 'source': 'conjugation'}, {'form': 'by moczyli', 'tags': ['conditional', 'plural', 'third-person', 'virile', 'derogatory'], 'source': 'conjugation'}, {'form': 'moczy≈Çyby', 'tags': ['conditional', 'nonvirile', 'plural', 'third-person'], 'source': 'conjugation'}, {'form': 'by moczy≈Çy', 'tags': ['conditional', 'nonvirile', 'plural', 'third-person', 'derogatory'], 'source': 'conjugation'}, {'form': 'moczono by', 'tags': ['conditional', 'impersonal'], 'source': 'conjugation'}, {'form': 'niech moczƒô', 'tags': ['imperative', 'singular', 'first-person'], 'source': 'conjugation'}, {'form': 'moczmy', 'tags': ['imperative', 'plural', 'first-person'], 'source': 'conjugation'}, {'form': 'mocz', 'tags': ['imperative', 'singular', 'second-person'], 'source': 'conjugation'}, {'form': 'moczcie', 'tags': ['imperative', 'plural', 'second-person'], 'source': 'conjugation'}, {'form': 'niech moczy', 'tags': ['imperative', 'singular', 'third-person'], 'source': 'conjugation'}, {'form': 'niech moczƒÖ', 'tags': ['imperative', 'plural', 'third-person'], 'source': 'conjugation'}, {'form': 'zmoczyƒá', 'tags': ['perfective']}, {'form': 'zamoczyƒá', 'tags': ['perfective']}, {'form': 'imperfective', 'source': 'conjugation', 'tags': ['table-tags']}, {'form': 'pl-conj-ai-yƒá', 'source': 'conjugation', 'tags': ['inflection-template']}, {'form': 'moczyƒá', 'tags': ['infinitive'], 'source': 'conjugation'}, {'form': 'moczƒÖcy', 'tags': ['active', 'adjectival', 'masculine', 'participle', 'singular'], 'source': 'conjugation'}, {'form': 'moczƒÖca', 'tags': ['active', 'adjectival', 'feminine', 'participle', 'singular'], 'source': 'conjugation'}, {'form': 'moczƒÖce', 'tags': ['active', 'adjectival', 'neuter', 'participle', 'singular'], 'source': 'conjugation'}, {'form': 'moczƒÖcy', 'tags': ['active', 'adjectival', 'participle', 'plural', 'virile'], 'source': 'conjugation'}, {'form': 'moczƒÖce', 'tags': ['active', 'adjectival', 'nonvirile', 'participle', 'plural'], 'source': 'conjugation'}, {'form': 'moczony', 'tags': ['adjectival', 'masculine', 'participle', 'passive', 'singular'], 'source': 'conjugation'}, {'form': 'moczona', 'tags': ['adjectival', 'feminine', 'participle', 'passive', 'singular'], 'source': 'conjugation'}, {'form': 'moczone', 'tags': ['adjectival', 'neuter', 'participle', 'passive', 'singular'], 'source': 'conjugation'}, {'form': 'moczeni', 'tags': ['adjectival', 'participle', 'passive', 'plural', 'virile'], 'source': 'conjugation'}, {'form': 'moczone', 'tags': ['adjectival', 'nonvirile', 'participle', 'passive', 'plural'], 'source': 'conjugation'}, {'form': 'moczƒÖc', 'tags': ['adjectival', 'contemporary', 'participle'], 'source': 'conjugation'}, {'form': 'moczenie', 'tags': ['noun-from-verb'], 'source': 'conjugation'}]

# adj_data = [{'form': 'du≈ºy', 'tags': ['masculine', 'nominative', 'singular', 'vocative'], 'source': 'declension'}, {'form': 'du≈ºe', 'tags': ['neuter', 'nominative', 'singular', 'vocative'], 'source': 'declension'}, {'form': 'du≈ºa', 'tags': ['feminine', 'nominative', 'singular', 'vocative'], 'source': 'declension'}, {'form': 'duzi', 'tags': ['nominative', 'plural', 'virile', 'vocative'], 'source': 'declension'}, {'form': 'du≈ºe', 'tags': ['nominative', 'nonvirile', 'plural', 'vocative'], 'source': 'declension'}, {'form': 'du≈ºego', 'tags': ['genitive', 'masculine', 'neuter', 'singular'], 'source': 'declension'}, {'form': 'du≈ºej', 'tags': ['feminine', 'genitive', 'singular'], 'source': 'declension'}, {'form': 'du≈ºych', 'tags': ['genitive', 'plural'], 'source': 'declension'}, {'form': 'du≈ºemu', 'tags': ['dative', 'masculine', 'neuter', 'singular'], 'source': 'declension'}, {'form': 'du≈ºej', 'tags': ['dative', 'feminine', 'singular'], 'source': 'declension'}, {'form': 'du≈ºym', 'tags': ['dative', 'plural'], 'source': 'declension'}, {'form': 'du≈ºego', 'tags': ['accusative', 'animate', 'masculine', 'singular'], 'source': 'declension'}, {'form': 'du≈ºy', 'tags': ['accusative', 'inanimate', 'masculine', 'singular'], 'source': 'declension'}, {'form': 'du≈ºe', 'tags': ['accusative', 'neuter', 'singular'], 'source': 'declension'}, {'form': 'du≈ºƒÖ', 'tags': ['accusative', 'feminine', 'singular'], 'source': 'declension'}, {'form': 'du≈ºych', 'tags': ['accusative', 'plural', 'virile'], 'source': 'declension'}, {'form': 'du≈ºe', 'tags': ['accusative', 'nonvirile', 'plural'], 'source': 'declension'}, {'form': 'du≈ºym', 'tags': ['instrumental', 'masculine', 'neuter', 'singular'], 'source': 'declension'}, {'form': 'du≈ºƒÖ', 'tags': ['feminine', 'instrumental', 'singular'], 'source': 'declension'}, {'form': 'du≈ºymi', 'tags': ['instrumental', 'plural'], 'source': 'declension'}, {'form': 'du≈ºym', 'tags': ['locative', 'masculine', 'neuter', 'singular'], 'source': 'declension'}, {'form': 'du≈ºej', 'tags': ['feminine', 'locative', 'singular'], 'source': 'declension'}, {'form': 'du≈ºych', 'tags': ['locative', 'plural'], 'source': 'declension'}, {'form': 'wiƒôkszy', 'tags': ['comparative']}, {'form': 'najwiƒôkszy', 'tags': ['superlative']}, {'form': 'du≈ºo', 'tags': ['adverb']}, {'form': 'du≈ºszy', 'tags': ['Middle', 'Polish', 'comparative']}, {'form': 'nadu≈ºszy', 'tags': ['Middle', 'Polish', 'superlative']}, {'form': 'najdu≈ºszy', 'tags': ['Middle', 'Polish', 'superlative']}, {'form': '', 'source': 'declension', 'tags': ['table-tags']}, {'form': 'pl-decl-adj-auto', 'source': 'declension', 'tags': ['inflection-template']}]

# result, invalid_forms, invalid_forms_percent = process_forms(adj_data)

# # pprint.pprint(result)
# print(result)